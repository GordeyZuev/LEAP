"""One-time script to generate template JSON for HSE Zoom courses."""

import json
from pathlib import Path

try:
    from fireworks_module.prompts import TRANSCRIPTION_DEFAULT_PROMPT
except ImportError:
    TRANSCRIPTION_DEFAULT_PROMPT = (
        "Это видео-семинар по курсу «{topic}». "
        "Сохраняй правильное написание профильных терминов (включая английские), "
        "аббревиатур и имён собственных. "
        "Учитывай особенности устной речи: неполные предложения, паузы, естественные интонации."
    )

TEMPLATES_DATA = [
    # (exact_match, subject, faculty_short, teacher_last, group_str, album_id)
    # kakaeva@hse.ru
    (
        "ВШБ Управление бизнесом_Основы программирования на Python_группа 9_Сусла Д.М.",
        "Основы программирования на Python",
        "ВШБ УБ",
        "Сусла",
        "гр. 9",
        "1",
    ),
    ("Дизайн СПБ_Анализ данных_группа 3_Демчук К.А.", "Анализ данных", "Дизайн СПБ", "Демчук", "гр. 3", "2"),
    ("Дизайн СПБ_Анализ данных_группа 4_Демчук К.А.", "Анализ данных", "Дизайн СПБ", "Демчук", "гр. 4", "3"),
    (
        "Факультет математики_Машинное обучение_группа 1_Корпачев С.С.",
        "Машинное обучение",
        "Матфак",
        "Корпачев",
        "гр. 1",
        "4",
    ),
    (
        "ВШБ Управление бизнесом_Основы программирования на Python_группа 10_Шишлов И.Д.",
        "Основы программирования на Python",
        "ВШБ УБ",
        "Шишлов",
        "гр. 10",
        "5",
    ),
    (
        "ФИКЛ_Программирование и компьютерные науки_группа 1_Сусла Д.М.",
        "Программирование и компьютерные науки",
        "ФИКЛ",
        "Сусла",
        "гр. 1",
        "6",
    ),
    ("Право_Анализ данных в Python_группа 2_Гусев В.Д.", "Анализ данных в Python", "Право", "Гусев", "гр. 2", "7"),
    (
        "Право_Анализ данных в Python_группа 3,4_Малкова К.Э.",
        "Анализ данных в Python",
        "Право",
        "Малкова",
        "гр. 3,4",
        "8",
    ),
    (
        "ВШБ Управление бизнесом_Основы программирования на Python_группа 8_Сусла Д.М.",
        "Основы программирования на Python",
        "ВШБ УБ",
        "Сусла",
        "гр. 8",
        "9",
    ),
    # fdzodzieva@hse.ru
    (
        "ВШБ Управление бизнесом_Основы программирования на Python_группа 12_Ликсаков М.В.",
        "Основы программирования на Python",
        "ВШБ УБ",
        "Ликсаков",
        "гр. 12",
        "10",
    ),
    (
        "ВШБ Управление бизнесом_Основы программирования на Python_группа 11_Ликсаков М.В.",
        "Основы программирования на Python",
        "ВШБ УБ",
        "Ликсаков",
        "гр. 11",
        "11",
    ),
    ("Дизайн СПБ_Анализ данных_группа 5,6_Соколов Я.И.", "Анализ данных", "Дизайн СПБ", "Соколов", "гр. 5,6", "12"),
    (
        "РИСО_Программирование на языке Python_группа 6_Иванов М.Д.",
        "Программирование на языке Python",
        "РИСО",
        "Иванов",
        "гр. 6",
        "13",
    ),
    (
        "Экономика_Основы программирования на Python_группа 1,2_Топалова Я.Р.",
        "Основы программирования на Python",
        "Экономика",
        "Топалова",
        "гр. 1,2",
        "14",
    ),
    ("Дизайн СПБ_Анализ данных_группа 1,2_Коршунова М.Р.", "Анализ данных", "Дизайн СПБ", "Коршунова", "гр. 1,2", "15"),
    (
        "Дизайн СПБ_Python для анализа данных_группа 5_Курченко М.А.",
        "Python для анализа данных",
        "Дизайн СПБ",
        "Курченко",
        "гр. 5",
        "16",
    ),
    (
        "Право_Анализ данных в Python_группа 5,6_Касьяненко Д.А.",
        "Анализ данных в Python",
        "Право",
        "Касьяненко",
        "гр. 5,6",
        "17",
    ),
    (
        "Дизайн СПБ_Python для анализа данных_группа 1,2_Смоленчук И.К.",
        "Python для анализа данных",
        "Дизайн СПБ",
        "Смоленчук",
        "гр. 1,2",
        "18",
    ),
    # arkoroleva@hse.ru
    (
        "ОП Экономика_Основы программирования на Python_группа 1,2_Топалова Я.",
        "Основы программирования на Python",
        "Экономика",
        "Топалова",
        "гр. 1,2",
        "19",
    ),
    (
        "ОП История_Программирование на Python_группа 2_Галушко И.Н.",
        "Программирование на Python",
        "История",
        "Галушко",
        "гр. 2",
        "20",
    ),
    (
        "ОП СПБ Дизайн_Анализ данных_группы 1,2_Коршунова М.Р.",
        "Анализ данных",
        "Дизайн СПБ",
        "Коршунова",
        "гр. 1,2",
        "21",
    ),
    (
        "ОП УБ_Основы программирования на Python_группа 4,5_Иванов М.Д.",
        "Основы программирования на Python",
        "УБ",
        "Иванов",
        "гр. 4,5",
        "22",
    ),
    (
        "ОП Матфак_Основы программирования на Python_группа 1_Корпачев С.С.1",
        "Основы программирования на Python",
        "Матфак",
        "Корпачев",
        "гр. 1 (С.С.1)",
        "23",
    ),
    (
        "ОП Матфак_Основы программирования на Python_группа 1_Кубаева А.Р.",
        "Основы программирования на Python",
        "Матфак",
        "Кубаева",
        "гр. 1",
        "24",
    ),
    (
        "ОП МагоЛего_ИИ для бизнеса: автоматизация без разработчиков_ Завелишко С.В.",
        "ИИ для бизнеса: автоматизация без разработчиков",
        "МагоЛего",
        "Завелишко",
        None,
        "25",
    ),
    (
        "ОП МагоЛего_Быстрое создание MVP в Data Science (МагоЛего)_Бурова М.Б.",
        "Быстрое создание MVP в Data Science",
        "МагоЛего",
        "Бурова",
        None,
        "26",
    ),
    ("ОП УвКИ_Анализ данных на Python_Д.Сусла", "Анализ данных на Python", "УвКИ", "Сусла", None, "27"),
    ("ОП Мактфак_Машинное обучение_группа 1_Корпачев С.С.", "Машинное обучение", "Матфак", "Корпачев", "гр. 1", "28"),
    # aparshina@hse.ru
    (
        "ОП Востоковедение_Анализ данных на Python_группа 3_Хорин А.М.",
        "Анализ данных на Python",
        "Востоковедение",
        "Хорин",
        "гр. 3",
        "29",
    ),
    # abadalova@hse.ru
    ("Право_Анализ данных в Python_группа 1_Сусла Д.М.", "Анализ данных в Python", "Право", "Сусла", "гр. 1", "30"),
    (
        "Цифровой юрист_Анализ данных в Python_группа 1,2_Сусла Д.М.",
        "Анализ данных в Python",
        "Цифровой юрист",
        "Сусла",
        "гр. 1,2",
        "31",
    ),
    (
        "Востоковедение_Программирование на языке Python_группа 5,6_Коршунова М.Р.",
        "Программирование на языке Python",
        "Востоковедение",
        "Коршунова",
        "гр. 5,6",
        "32",
    ),
    # tnikulin@hse.ru
    (
        "Филология_Анализ данных, искусственный интеллект и генеративные модели_группа 4_Галушко И.Н.",
        "Анализ данных, ИИ и генеративные модели",
        "Филология",
        "Галушко",
        "гр. 4",
        "33",
    ),
    (
        "Филология_Анализ данных, искусственный интеллект и генеративные модели_группа 5_Галушко И.Н.",
        "Анализ данных, ИИ и генеративные модели",
        "Филология",
        "Галушко",
        "гр. 5",
        "34",
    ),
    ("Дизайн СПБ_Анализ данных_группа 7, 8_Семенов Г.Ю.", "Анализ данных", "Дизайн СПБ", "Семенов", "гр. 7,8", "35"),
    (
        "Дизайн СПБ_Python для анализа данных_группа 5_Курченко М.А.",
        "Python для анализа данных",
        "Дизайн СПБ",
        "Курченко",
        "гр. 5",
        "36",
    ),
    (
        "Дизайн СПБ_Python для анализа данных_группа 6_Курченко М.А.",
        "Python для анализа данных",
        "Дизайн СПБ",
        "Курченко",
        "гр. 6",
        "37",
    ),
    # chrisros9370@gmail.com
    (
        "Объединенный план общевузовских дисциплин_AI и no-code для менеджмента: автоматизация рутины_группа 1_Бурова М.Б.",
        "AI и no-code для менеджмента",
        "ОПОД",
        "Бурова",
        "гр. 1",
        "38",
    ),
    ("Дизайн СПБ_Анализ данных_группа 3,4_Демчук К.А.", "Анализ данных", "Дизайн СПБ", "Демчук", "гр. 3,4", "39"),
    (
        "Дизайн СПБ_Python для анализа данных_группа 3,4_Симакова Е.А.",
        "Python для анализа данных",
        "Дизайн СПБ",
        "Симакова",
        "гр. 3,4",
        "40",
    ),
    ("Цифровой юрист_Анализ данных_группа 1,2_Сусла Д.М.", "Анализ данных", "Цифровой юрист", "Сусла", "гр. 1,2", "41"),
    (
        "ФИКЛ_Программирование и компьютерные науки_группа 1_Сусла Д.М.",
        "Программирование и компьютерные науки",
        "ФИКЛ",
        "Сусла",
        "гр. 1",
        "42",
    ),
    (
        "Экономика_Основы программирования на Python_группа 1,2_Топалова Я.Р.",
        "Основы программирования на Python",
        "Экономика",
        "Топалова",
        "гр. 1,2",
        "43",
    ),
    (
        "Объединенный план общевузовских дисциплин_Искусственный интеллект в маркетинге, СМИ и PR_группа 1_Нам Ю.Н.",
        "ИИ в маркетинге, СМИ и PR",
        "ОПОД",
        "Нам",
        "гр. 1",
        "44",
    ),
    (
        "Объединенный план общевузовских дисциплин_Автоматизация задач с использованием ИИ_группа 1_Бакшук М.В.",
        "Автоматизация задач с ИИ",
        "ОПОД",
        "Бакшук",
        "гр. 1",
        "45",
    ),
    # amaksaev@hse.ru
    (
        "Городское планирование_Программирование на языке Python_группа 1_Перевышина Т.О.",
        "Программирование на языке Python",
        "Городское планирование",
        "Перевышина",
        "гр. 1",
        "46",
    ),
    # zoom4@cshse.ru
    (
        "История_Программирование на Python_группа 1_Галушко И.Н.",
        "Программирование на Python",
        "История",
        "Галушко",
        "гр. 1",
        "47",
    ),
    (
        "История_Программирование на Python_группа 3_Галушко И.Н.",
        "Программирование на Python",
        "История",
        "Галушко",
        "гр. 3",
        "48",
    ),
    (
        "История_Программирование на Python_группа 11_Бакшук М.В.",
        "Программирование на Python",
        "История",
        "Бакшук",
        "гр. 11",
        "49",
    ),
    (
        "История_Программирование на Python_группа 10_Бакшук М.В.",
        "Программирование на Python",
        "История",
        "Бакшук",
        "гр. 10",
        "50",
    ),
]

# Vocabulary for transcriber by subject (transcription_vocabulary)
SUBJECT_VOCABULARY: dict[str, list[str]] = {
    "Основы программирования на Python": ["NumPy", "Pandas", "pip", "virtualenv", "декоратор", "итератор", "генератор"],
    "Анализ данных": ["NumPy", "Pandas", "DataFrame", "корреляция", "визуализация", "статистика"],
    "Машинное обучение": [
        "gradient descent",
        "overfitting",
        "accuracy",
        "NumPy",
        "Pandas",
        "Scikit-learn",
        "нейронная сеть",
    ],
    "Программирование и компьютерные науки": ["NumPy", "Pandas", "синтаксис", "переменная", "функция", "цикл"],
    "Анализ данных в Python": ["NumPy", "Pandas", "DataFrame", "Jupyter", "EDA"],
    "Анализ данных на Python": ["NumPy", "Pandas", "DataFrame", "Jupyter", "EDA"],
    "Программирование на языке Python": ["NumPy", "Pandas", "синтаксис", "переменная", "функция"],
    "Python для анализа данных": ["NumPy", "Pandas", "Matplotlib", "корреляция", "статистика"],
    "Программирование на Python": ["NumPy", "Pandas", "синтаксис", "декоратор", "итератор"],
    "ИИ для бизнеса: автоматизация без разработчиков": ["ChatGPT", "LLM", "no-code", "автоматизация"],
    "Быстрое создание MVP в Data Science": ["MVP", "Data Science", "NumPy", "Pandas", "Jupyter"],
    "Анализ данных, ИИ и генеративные модели": ["NumPy", "Pandas", "LLM", "transformer", "генеративные модели"],
    "AI и no-code для менеджмента": ["ChatGPT", "LLM", "no-code", "автоматизация"],
    "ИИ в маркетинге, СМИ и PR": ["ChatGPT", "LLM", "генеративные модели", "контент"],
    "Автоматизация задач с ИИ": ["ChatGPT", "LLM", "автоматизация", "API"],
}

# Map subject to discipline name for prompt
DISCIPLINE_MAP = {
    "Основы программирования на Python": "Основы программирования на Python",
    "Анализ данных": "Анализ данных",
    "Машинное обучение": "Машинное обучение",
    "Программирование и компьютерные науки": "Программирование и компьютерные науки",
    "Анализ данных в Python": "Анализ данных в Python",
    "Анализ данных на Python": "Анализ данных на Python",
    "Программирование на языке Python": "Программирование на языке Python",
    "Python для анализа данных": "Python для анализа данных",
    "Программирование на Python": "Программирование на Python",
    "ИИ для бизнеса: автоматизация без разработчиков": "ИИ для бизнеса: автоматизация без разработчиков",
    "Быстрое создание MVP в Data Science": "Быстрое создание MVP в Data Science",
    "Анализ данных, ИИ и генеративные модели": "Анализ данных, искусственный интеллект и генеративные модели",
    "AI и no-code для менеджмента": "AI и no-code для менеджмента: автоматизация рутины",
    "ИИ в маркетинге, СМИ и PR": "Искусственный интеллект в маркетинге, СМИ и PR",
    "Автоматизация задач с ИИ": "Автоматизация задач с использованием ИИ",
}


def build_template(exact_match, subject, faculty, teacher, group_str, album_id):
    if group_str:
        name = f"{subject} – {faculty}, {teacher}, {group_str}"
    else:
        name = f"{subject} – {faculty}, {teacher}"

    discipline = DISCIPLINE_MAP.get(subject, subject)
    prompt = TRANSCRIPTION_DEFAULT_PROMPT.format(topic=discipline)

    title_template = name + " | {themes} ({record_time:DD.MM.YY})"

    return {
        "name": name,
        "description": f"{name} - VK.",
        "matching_rules": {
            "exact_matches": [exact_match],
            "keywords": None,
            "patterns": None,
            "source_ids": [4],
            "exclude_keywords": None,
            "exclude_patterns": None,
            "case_sensitive": False,
        },
        "processing_config": {
            "transcription": {
                "enable_transcription": True,
                "prompt": prompt,
                "language": "ru",
                "allow_errors": False,
                "enable_topics": True,
                "granularity": "long",
                "enable_subtitles": True,
            },
            "transcription_vocabulary": SUBJECT_VOCABULARY.get(subject, []),
        },
        "metadata_config": {
            "vk": {
                "album_id": album_id,
                "group_id": None,
                "thumbnail_name": None,
                "title_template": None,
                "description_template": None,
            },
            "title_template": title_template,
            "description_template": None,
            "topics_display": None,
            "thumbnail_name": None,
        },
        "output_config": {
            "preset_ids": [4],
            "auto_upload": True,
            "upload_captions": True,
        },
    }


templates = []
for row in TEMPLATES_DATA:
    templates.append(build_template(*row))

output_path = Path("docs/examples/hse_templates.json")
with output_path.open("w", encoding="utf-8") as f:
    json.dump(templates, f, ensure_ascii=False, indent=2)

print(f"Generated {len(templates)} templates → {output_path}")
